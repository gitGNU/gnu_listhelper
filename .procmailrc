
PATH=$HOME/bin:/usr/local/bin:/usr/bin:/bin
# Let deliver to /var/mail/mlmgr for now and my cron will remind me to read it.
#DEFAULT=$MAILDIR/Maildir/
COMSAT=no
MAILDIR=$HOME/Mail
ARCHIVE=ARCHIVE
LOGFILE=$HOME/log/procmail.logfile
# VERBOSE=on
UMASK=02

:0
* ^X-Original-To: listhelper-honeypot
honeypot/

:0
* ^X-Original-To: listhelper-obsolete
obsolete/

# Mail to the moderators.  Process and handle.  SpamAssassin is run
# from this script after unpacking the attached message.

## If it is from a mailer daemon then we want to discard it.
#:0c
#* 1^0 ^From: (.*<)?MAILER-DAEMON@
#* 1^0 ^From: (.*<)?postmaster@
#would-discard/
#
## Chain on the previous rule ('A' flag).
#:0A
#| mailman-discard

## Special to avoid full spamassassin processing on known signature.
#:0c
#* ^Subject: [^ ]+$
#* ^In order to benefit from this lucrative opportunity you need
#* ^to get in now, before the big news release.
#would-discard2/
#
## Chain on the previous rule ('A' flag).
#:0Aw:serialize.lock
#| mailman-discard-nolearn || exit 75

#:0HB:
#* ^Subject: [^ ]+$
#* ^One of the key rules every good trader knows is volume
#* ^before price.  Once the volume is there the price will
#would-discard2/
#
## Chain on the previous rule ('A' flag).
#:0Aw:serialize.lock
#| mailman-discard-nolearn || exit 75

## Chain on the previous rule ('A' flag).
#:0Aw:serialize.lock
#| mailman-discard-nolearn || exit 75

#:0HBc
#* ^Subject: [^ ]+ post from [^ ]+ requires approval
#* ^As list administrator, your authorization is requested for the
#* ^Subject: confirm
#would-discard2/
#
## Chain on the previous rule ('A' flag).
#:0Aw:serialize.lock
#| mailman-discard-nolearn || exit 75

:0w:serialize.lock
* ^X-List-Administrivia: yes
* ^Subject: .* post from
| mailman-filter || exit 75

# Example:
#   Subject: =?iso-8859-1?q?El_envio_a_GNUGNU_de_ansjohn=5F53=40hotmail=2Ecom?=
#   	=?iso-8859-1?q?_precisa_de_aprobacion?=
:0w:serialize.lock
* ^X-List-Administrivia: yes
* ^Subject: .*El[ _]envio[ _]a[ _].*[ _]precisa[ _]de[ _]aprobacion
| mailman-filter || exit 75

# Added and combined with other List-Administrivia patterns.
# Example for the regular expression match:
#   Subject: 1 bug-gnu-utils moderator request(s) waiting
#   Subject: bug-grep subscription notification
#   Subject: tug.org mailing list memberships reminder

:0
* ^X-List-Administrivia: yes
{
  :0
  * 1^0 ^Subject: The results of your email commands
  * 1^0 ^Subject: Auto-discard notification
  * 1^0 ^Subject: Last autoresponse notification for today
  * 1^0 ^Subject: [-a-zA-Z0-9]+ subscription notification
  * 1^0 ^Subject: [-a-zA-Z0-9]+ unsubscribe notification
  # Example spanish The results of your email commands
  # Subject: =?iso-8859-1?q?Resultados_de_los_comandos_enviados_por_correo_el?=
  #  =?iso-8859-1?q?ectronico?=
  * 1^0 ^Subject: .*Notificaci.*n_de_suscripci.*n
  # Subject: =?iso-8859-1?q?Notificaci=F3n_de_desuscripci=F3n_a_Radius-espano?=
  #  =?iso-8859-1?q?l?=
  # Subject: =?iso-8859-1?q?fsfe-de_unsubscribe_notification?=
  * 1^0 ^Subject: .*unsubscribe.notification
  * 1^0 ^Subject: .*Notificaci.*n_de_desuscripci.*n
  * 1^0 ^Subject: .*Resultados_de_los_comandos_enviados_por_correo_el
  # Subject: =?iso-8859-1?q?notification_d=27abonnement_de_lilypond-user-fr?=
  * 1^0 ^Subject: .*notification.d.*abonnement_de_
  # Subject: =?iso-8859-1?q?notification_de_r=E9siliation_de_lilypond-user-fr?=
  * 1^0 ^Subject: .*notification.de.r.*siliation.de
  # Subject: M-Zltima notificaciM-sn de autorespuesta de hoy
  * 1^0 ^Subject: .*tima.notificaci.*de.autorespuesta.de.hoy
  # =?iso-8859-1?q?notifica=E7=E3o_de_inscri=E7=E0o_de_Esteban-users?=
  * 1^0 Subject: .*notifica..o_de_inscri._o_de
  /dev/null

  :0
  * 1^0 ^Subject: [0-9]+ [-a-zA-Z0-9]+ moderator request
  * 1^0 ^Subject: [-a-zA-Z0-9.]+ mailing list memberships reminder
  * 1^0 ^Subject: Bounce action notification
  administrivia/
}

# I think this is a mailman bug that it sends messages to the list owner
# to the list moderators too.  /dev/null these.

:0
* ^Sender: mailman-bounces@
* ^TO_[-a-zA-Z0-9]+-owner@
/dev/null

# Mail to the list.  Probably approved but possibly whitelisted.
# Teach all mail through the list as non-spam.  Be careful that random
# other mail through this account is not taught.  This is needed
# because mailman sends other types of messages to the moderator
# address.

# Keep a running counter for later graphing of data.
:0wic:listcounter.lock
| sh -c 'expr $(<$HOME/Mail/listcounter) + 1 >$HOME/Mail/listcounter'

:0c
* ^X-BeenThere: [-a-zA-Z0-9]+@
* ^Precedence: (list|bulk|fm-user)
* ^List-Archive:
* ^List-Id:
* ^List-Post:
* ^List-Subscribe:
* ^List-Unsubscribe:
| sa-learn --ham >/dev/null 2>&1

# Archive all mail that comes through to the lists.
# Chain on the previous rule ('A' flag) and match on the listname.

:0A
* ^X-BeenThere: [-a-zA-Z0-9]+@
* ^X-BeenThere: \/[-a-zA-Z0-9]+
$ARCHIVE/$MATCH/

# There is a lot of miscellaneous mail to the listhelper which is ignored.
:0
* ^Sender: mailman-bounces@
/dev/null
