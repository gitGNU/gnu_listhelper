#!/bin/sh

# The mailboxes would grow without bounds unless pruned.
# Archive the mail into the OLD directory.

if [ ! -t 0 ]; then
    exec >/tmp/archive-mail.out 2>&1
fi

cd $HOME/Mail || exit 1

find caughtspam/cur -type f -print0 | xargs -r0 mv --target-directory=caughtspam-archive/cur/

mkdir -p \
  OLD/administrivia/cur \
  OLD/administrivia/new \
  OLD/administrivia/tmp \
  OLD/caughtham-mm/cur \
  OLD/caughtham-mm/new \
  OLD/caughtham-mm/tmp \
  OLD/caughtham/cur \
  OLD/caughtham/new \
  OLD/caughtham/tmp \
  OLD/caughtspam-archive/cur \
  OLD/caughtspam-archive/new \
  OLD/caughtspam-archive/tmp \
  OLD/caughtspam-mm/cur \
  OLD/caughtspam-mm/new \
  OLD/caughtspam-mm/tmp \
  OLD/spam/cur \
  OLD/spam/new \
  OLD/spam/tmp \
  OLD/would-discard/cur \
  OLD/would-discard/new \
  OLD/would-discard/tmp

find \
  administrivia \
  caughtham \
  caughtham-mm \
  caughtspam-archive \
  caughtspam-mm \
  spam \
  would-discard \
  -type f -mtime +4 -printf "mv %p OLD/%p\n" \
  | sh

find OLD -type f -mtime +14 -print0 | xargs -r0 rm -f

exit 0
